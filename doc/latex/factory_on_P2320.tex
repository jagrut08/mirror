\documentclass[compress,table,xcolor=table]{beamer}
\input{beamer_mirror.tex}
\setlength{\paperwidth}{17.0cm}
\setlength{\paperheight}{10.0cm}
\setlength{\textwidth}{15.0cm}
\setlength{\textheight}{9.0cm}
\begin{document}
% ------------------------------------------------------------------------------
\title{Implementing Factory builder on top of P2320}
% - Overview -------------------------------------------------------------------
\section{Overview}
\frame{\titlepage}
% ------------------------------------------------------------------------------
\begin{frame}
    \Huge
    \centering{The goal}
    \vfill
    \LARGE
    \centering{(Semi-)automate the implementation\\of the\\Factory design pattern}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
\frametitle{What is meant by \say{Factory} here?}
  \Large
  \begin{itemize}
      \item Class that constructs instances of a \say{\larger Product} type.
      \item From some external representation:
      \begin{itemize}
        \large
      \item XML,
      \item JSON,
      \item YAML,
      \item a GUI,
      \item a scripting language,
      \item a relational database,
      \item \ldots
      \end{itemize}
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
  \frametitle{Factory builder}
    \Huge
  \begin{itemize}
    \item{Framework combining the following parts}
    \begin{itemize}
      \LARGE
    \item Meta-data 
          \begin{itemize}
          \Large
        \item obtained from reflection.
          \end{itemize}
    \item Traits
          \begin{itemize}
          \Large
        \item units of code that handle various stages of construction,
        \item specific to a particular external representation,
        \item provided by user.
        \end{itemize}
      \end{itemize}
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
  \frametitle{Factory builder}
  \Huge
    \begin{itemize}
    \item{Used meta-data}
          \begin{itemize}
        \Large
        \item type name strings,
        \item list of meta-objects reflecting constructors,
        \item list of meta-objects reflecting constructor parameters,
        \item parameter type,
        \item parameter name,
        \item \ldots
          \end{itemize}
    \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
  \frametitle{Factory builder}
  \Huge
  \begin{itemize}
    \item{Units handling the stages of construction}
          \begin{itemize}
        \Large
        \item selecting the \say{best} constructor,
        \item invoking the selected constructor,
        \item conversion of parameter values from the external representation,
        \item may recursively use factories for composite parameter types.
        \end{itemize}
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{Used reflection features}
  \large
    \begin{itemize}
        \item \verb@^T@
        \item \verb@[: :]@\footnote{to get back the reflected type}
        \item \verb@meta::name_of@
        \item \verb@meta::type_of@
        \item \verb@meta::members_of@
        \item \verb@meta::is_constructor@
        \item \verb@meta::is_default_constructor@
        \item \verb@meta::is_move_constructor@
        \item \verb@meta::is_copy_constructor@
        \item \verb@meta::parameters_of@
        \item \verb@size(Range)@
        \item range iterators
    \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
  \frametitle{Reflection review}
    \Huge
    \begin{itemize}
    \item{The good\footnote{great actually!}}
        \begin{itemize}
        \Large
        \item{How extensive and powerful the API is}
        \end{itemize}
    \item{The bad}
        \begin{itemize}
        \Large
        \item{Didn't find much\footnote{some details follow}}
        \end{itemize}
    \item{The ugly}
        \begin{itemize}
        \Large
        \item{Some of the syntax}
        \end{itemize}
    \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
\frametitle{What is missing(?\footnote{maybe I overlooked something})}
    \Large
    \begin{itemize}
    \item The ability easily to unpack meta-objects from a range into a template,
        without un-reflecting them.
    \item I used the following workaround + \verb@make_index_sequence@:
    \end{itemize}
    \begin{lstlisting}[language=c++]
  template <typename Iterator>
  consteval auto advance(Iterator it, size_t n) {
    while(n-- > 0) {
      ++it;
    }
    return it;
  }
    \end{lstlisting}
    \begin{itemize}
    \item Details follow\ldots
    \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
\frametitle{Metaobject range unpacking}
  \Large
  The goal is to unpack a metaobject range into a template like this:
    \begin{lstlisting}[language=c++]
  template <meta::info... MO>
  struct unpacked_range {
    constexpr static auto count = sizeof...(MO);
    // etc.
  };
    \end{lstlisting}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
    \frametitle{Metaobject range unpacking (cont.)}
  \Large
  Unlike \verb@meta::info@ the \verb@detail::range@ type is not part of the
    public API, passing ranges as template parameters is not straightforward.
  \vfill
  So we are using this helper function, which makes the whole thing less generic.
    \begin{lstlisting}[language=c++]
  template <meta::info MO>
  consteval auto constructors_of() {
    return meta::members_of(
      ^my_class, meta::is_constructor);
  }
    \end{lstlisting}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
\frametitle{Metaobject range unpacking (cont.)}
	\large
	A helper:
    \begin{lstlisting}[language=c++]
  template <meta::info MO, std::size_t... I>
  consteval auto do_unpack_range(std::index_sequence<I...>) {
    return unpacked_range<*(*@\listinghl{advance}@*)(
      (*@\listinghl{constructors\_of}@*)<MO>().begin(),
      I)...>{};
  }
    \end{lstlisting}
    \vfill
	The unpack function:
    \begin{lstlisting}[language=c++]
  template <meta::info MO>
  consteval auto unpack_range() {
    return do_unpack_range<MO>(
      std::(*@\listinghl{make\_index\_sequence}@*)<
        size((*@\listinghl{constructors\_of}@*)<MO>())
      >{});
  }
    \end{lstlisting}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
\frametitle{Metaobject range unpacking -- use case}
    \begin{lstlisting}[language=c++]
	struct <typename Metaobjects>
	struct my_derived;
    \end{lstlisting}

    \begin{lstlisting}[language=c++]
	template <meta::info ... MO>
	struct my_derived<unpacked_range<MO...>>
	 : my_base<MO>... {
      // ...
	};
    \end{lstlisting}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}
    \Huge
    \centering{Kudos to the implementers}
    \vfill
    \LARGE
    \centering{Some details on the factory builder follow}
\end{frame}
% - Details --------------------------------------------------------------------
\section{Details}
% ------------------------------------------------------------------------------
\begin{frame}[fragile]
\frametitle{The mirror reflection utilities}
    \Large
    \begin{itemize}
        \item \url{https://github.com/matus-chochlik/mirror}
        \item implements the factory builder framework and some traits:
        \begin{itemize}
            \large
            \item simple input from \verb@iostreams@,
            \item input from JSON (using RapidJSON),
            \item input from a GUI (using Qt5/QML),
            \item others are planned.
        \end{itemize}
        \item plans for some additional use-cases:
        \begin{itemize}
            \large
            \item serialization/de-serialization,
            \item Python bindings,
            \item \ldots
        \end{itemize}
        \item There is an older implementation using manually-provided meta-data:
            \url{https://sourceforge.net/projects/mirror-lib/}
    \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\end{document}
